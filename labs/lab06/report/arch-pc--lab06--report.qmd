---
## Author
author:
  name: Гущина Екатерина Антоновна
  degrees: студент
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6

## Title
title: "Отчёта по лабораторной работе № 6"
subtitle: "Арифметические операции в NASM"
license: "CC BY"
---

# Цель работы

Освоение арифметических инструкций языка ассемблера NASM.

# Выполнение лабораторной работы

## Символьные и численные данные в NASM

Создадим каталог ~/work/arch-pc/lab06 для программам лабораторной работы № 6, перейдем в него и создадим файл lab6-1.asm:

![Создание файла lab6-1.asm](image/1.png)

Введем в файл lab6-1.asm следующий текст программы:

![Текст программы lab6-1.asm](image/2.png)

Программа включает файл in_out.asm, который мы использовали в лабораторной работе № 5. Скопируем его в текущую рабочую папку, создадим исполняемый файл lab6-1 и запустим:

![Сборка и запуск программы lab6-1](image/3.png)

Результат вывода - символ 'j', так как в программе складывались значения ascii символов '6' и '4' (54 и 53 в десятичном представлении) и получили результат, равный 106 (ascii 'j').

Изменим текст программы lab6-1.asm и вместо символов, запишем в регистры числа:

![Текст измененной программы lab6-1.asm](image/4.png)

Создадим исполняемый файл lab6-1 и запустим его:

![Сборка и запуск измененной программы lab6-1](image/5.png)

В данном случае выводится символ с кодом 10 - это отображается при выводе на экран в виде перевода строки (добавлена новая строка).

Изменим текст программы с использованием подпрограмм из файла in_out.asm для преобразования ASCII символов в числа и обратно. Для этого создадим файл lab6-2.asm в каталоге ~/work/arch-pc/lab06 и введите в него следующий текст программы:

![Текст программы lab6-2.asm](image/6.png)

Создадим исполняемый файл и запустим его:

![Сборка и запуск программы lab6-2](image/7.png)

В результате работы программы мы получим число 106. В данном случае, как и в первом, команда `add` складывает коды символов ‘6’ и ‘4’ (54+52=106). Однако, в отличии от предыдущей версии программы, функция `iprintLF` позволяет вывести число, а не символ, кодом которого является это число.

Аналогично предыдущему примеру изменим в файле lab6-2.asm символы на числа:

![Текст измененной программы lab6-2.asm](image/8.png)

Создадим исполняемый файл lab6-2 и запустим его:

![Сборка и запуск измененной программы lab6-2](image/9.png)

В результате работы программы мы получим число 10. В данном случае программа складывает числа 4 и 6. Функция `iprintLF` выводит результат сложения в виде числа.

Заменим функцию `iprintLF` на `iprint`, создадим исполняемый файл lab6-2 и запустим:

![Замена iprintLF на iprint](image/10.png)

В данном случае программа также выведет число 10, но без перевода на новую строку.

## Выполнение арифметических операций в NASM

В качестве примера выполнения арифметических операций в NASM приведем программу вычисления арифметического выражения $f(x) = (5 ∗ 2 + 3)/3$.

Создадим файл lab6-3.asm в каталоге ~/work/arch-pc/lab06 и введем текст программы:

![Текст программы lab6-3.asm](image/11.png)

Создадим исполняемый файл lab6-3 и запустим его:

![Сборка и запуск программы lab6-3](image/12.png)

Результат деления равен 4, а остаток равен 1, что и ожидалось.

Измените текст программы lab6-3.asm для вычисления выражения $f(x) = (4∗6 + 2)/5$:

![Текст измененной программы lab6-3.asm](image/13.png)

Создадим исполняемый файл lab6-3 и запустим его:

![Сборка и запуск программы lab6-3](image/14.png)

Результат деления равен 5, а остаток равен 1, что и ожидалось.

Напишем программу вычисления варианта задания по номеру студенческого билета, работающую по следующему алгоритму:
- вывести запрос на введение № студенческого билета;
- вычислить номер варианта по формуле: $(S_n \mod 20)+1$, где $S_n$ – номер студенческого билета (В данном случае $a \mod b$ – это остаток от деления $a$ на $b$);
- вывести на экран номер варианта.

В данном случае число, над которым необходимо проводить арифметические операции, вводится с клавиатуры. Ввод с клавиатуры осуществляется в символьном виде и для корректной работы арифметических операций в NASM символы необходимо преобразовать в числа. Для этого может быть использована функция `atoi` из файла in_out.asm.

Создадим файл variant.asm в каталоге ~/work/arch-pc/lab06 и введем текст программы:

![Текст программы variant.asm](image/15.png)

Создадим исполняемый файл variant и запустим его:

![Сборка и запуск программы variant](image/16.png)

При вводе номера студенческого билета получили номер варианта 7.
Номер студенческого билета 780786: $(780786 \mod 20)+1 = 6+1 = 7$, что совпадает с выводом программы.

Ответим на следующие вопросы:

1. Какие строки отвечают за вывод на экран сообщения 'Ваш вариант:'?

За вывод на экран сообщения отвечают следующие строки:
```
mov eax, msg
call sprintfLF
```

2. Для чего используется следующие инструкции?
```
mov ecx, x
mov edx, 80
call sread
```
Данные инструкции используются для ввода строки (с номером студенческого билета).

3. Для чего используется инструкция `call atoi`?

Инструкция `call atoi` используется для преобразования строки, адрес начала которой передается в регистре eax, в число, которое возвращается в регистре `eax`.

4. Какие строки отвечают за вычисления варианта?

За вычисления варианта отвечают следующие строки:
```
xor edx, edx
mov ebx, 20
div ebx
inc edx
```

5. В какой регистр записывается остаток от деления при выполнении инструкции `div ebx`?

Остаток от деления записывается в регистр `edx`.

6. Для чего используется инструкция `inc edx`?

Данная инструкция используется для инкремента (увеличения на 1) значения в регистре `edx`.

7. Какие строки отвечают за вывод на экран результата вычислений?

За вывод на экран результата вычислений отвечают следующие строки:
```
mov eax, rem
call sprint
mov eax, edx
call iprintLF
```
Первые две строки выводят поясняющее сообщение ('Ваш вариант: '), последние две строки выводят число - результат вычисления (вариант).

# Задание для самостоятельной работы

Написать программу вычисления выражения $y=f(x)$. Программа должна выводить выражение для вычисления, выводить запрос на ввод значения $x$, вычислять заданное выражение в зависимости от введенного $x$, выводить результат вычислений. Вид функции $f(x)$ выбрать из таблицы в соответствии с номером полученным при выполнении лабораторной работы.

| Номер варианта | Выражение для $f(x)$ | $x_1$ | $x_2$ |
|:--------------:|:--------------------:|:-----:|:-----:|
|       7        |     $5(x-1)^2$       |   3   |   5   |

: Вариант задания {#tbl-variant}

Создадим новый файл lab6-4.asm в каталоге ~/work/arch-pc/lab06 и введем текст программы, вычисляющей значение функции из [табл. @tbl-variant]:

![Текст программы lab6-4.asm](image/17.png)

Создадим исполняемый файл lab6-4 и запустим его со значениями $x_1$ и $x_2$ из [табл. @tbl-variant]:

![Сборка и запуск программы lab6-4](image/18.png)

Для $x=3$ имеем $5*(3-1)^2=5*4=20$. Для $x=5$ имеем $5*(5-1)^2=5*16=80$. Аналитические результаты совпадают с результатами работы программы.

# Выводы

Освоили арифметические инструкции языка ассемблера NASM.
